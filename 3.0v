-- BloodDebt ESP Ultra-Lite v4.0
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Heartbeat = RunService.Heartbeat

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏
local UPDATE_DELAY = 4 -- —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É –ø–æ–ª–Ω—ã–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
local FAST_UPDATE = 0.5 -- —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É –±—ã—Å—Ç—Ä—ã–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏
local MAX_DISTANCE = 150 -- studs

-- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
local LocalPlayer = Players.LocalPlayer
local PlayerCharacters = {}
local RoleCache = {}
local LastFullUpdate = 0

-- –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π
local ROLE_COLORS = {
    Murderer = Color3.fromRGB(255, 50, 50),
    Sheriff = Color3.fromRGB(50, 50, 255),
    Juggernaut = Color3.fromRGB(180, 0, 0),
    Armed = Color3.fromRGB(175, 255, 255),
    Innocent = Color3.fromRGB(50, 255, 50)
}

-- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π UI
local StatsUI = Instance.new("ScreenGui")
StatsUI.Name = "BD_ESP_Stats"
StatsUI.ResetOnSpawn = false

local StatsFrame = Instance.new("Frame")
StatsFrame.Size = UDim2.new(0, 200, 0, 120)
StatsFrame.Position = UDim2.new(1, -210, 0, 10)
StatsFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
StatsFrame.BackgroundTransparency = 0.7
StatsFrame.BorderSizePixel = 0

local StatsLabel = Instance.new("TextLabel")
StatsLabel.Size = UDim2.new(1, -10, 1, -10)
StatsLabel.Position = UDim2.new(0, 5, 0, 5)
StatsLabel.BackgroundTransparency = 1
StatsLabel.TextColor3 = Color3.new(1, 1, 1)
StatsLabel.Font = Enum.Font.SourceSansBold
StatsLabel.TextSize = 16
StatsLabel.TextXAlignment = Enum.TextXAlignment.Left
StatsLabel.TextYAlignment = Enum.TextYAlignment.Top

StatsLabel.Parent = StatsFrame
StatsFrame.Parent = StatsUI
StatsUI.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
local function CheckWeapon(character, weaponLists)
    for _, tool in ipairs(character:GetChildren()) do
        if tool:IsA("Tool") and weaponLists[tool.Name] then
            return true
        end
    end
    return false
end

local function GetPlayerRole(player)
    local character = player.Character
    if not character then return "Innocent" end
    
    -- –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞
    if RoleCache[player] and os.clock() - RoleCache[player].time < UPDATE_DELAY then
        return RoleCache[player].role, RoleCache[player].weapon
    end

    -- –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
    local role, weapon = "Innocent"
    local backpack = player:FindFirstChild("Backpack")
    
    if CheckWeapon(character, WEAPONS.MURDERER) or (backpack and CheckWeapon(backpack, WEAPONS.MURDERER)) then
        role = "Murderer"
    elseif CheckWeapon(character, WEAPONS.SHERIFF) or (backpack and CheckWeapon(backpack, WEAPONS.SHERIFF)) then
        role = "Sheriff"
    elseif CheckWeapon(character, WEAPONS.JUGGERNAUT) or (backpack and CheckWeapon(backpack, WEAPONS.JUGGERNAUT)) then
        role = "Juggernaut"
    elseif CheckWeapon(character, WEAPONS.INNOCENT) or (backpack and CheckWeapon(backpack, WEAPONS.INNOCENT)) then
        role = "Armed"
    end

    RoleCache[player] = {
        role = role,
        weapon = weapon,
        time = os.clock()
    }
    
    return role, weapon
end

local function UpdatePlayerDisplay(player)
    local character = player.Character
    if not character then return end
    
    local role = GetPlayerRole(player)
    local head = character:FindFirstChild("Head")
    if not head then return end

    -- –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
    for _, child in ipairs(character:GetDescendants()) do
        if child.Name == "BD_Highlight" or child.Name == "BD_Tag" then
            child:Destroy()
        end
    end

    -- –ü–æ–¥—Å–≤–µ—Ç–∫–∞
    local highlight = Instance.new("Highlight")
    highlight.Name = "BD_Highlight"
    highlight.FillColor = ROLE_COLORS[role] or ROLE_COLORS.Innocent
    highlight.FillTransparency = 0.8
    highlight.OutlineTransparency = 0.5
    highlight.Parent = character

    -- –¢–µ–≥ —Å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ–º
    local distance = "??"
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        distance = math.floor((character.HumanoidRootPart.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude).."m"
    end

    local tag = Instance.new("BillboardGui")
    tag.Name = "BD_Tag"
    tag.Size = UDim2.new(0, 200, 0, 40)
    tag.StudsOffset = Vector3.new(0, 2.5, 0)
    tag.AlwaysOnTop = true
    tag.MaxDistance = MAX_DISTANCE
    tag.Adornee = head

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 1, 0)
    label.BackgroundTransparency = 1
    label.TextColor3 = ROLE_COLORS[role] or ROLE_COLORS.Innocent
    label.Font = Enum.Font.SourceSansBold
    label.TextSize = 14
    label.Text = role == "Innocent" and player.Name or ("["..role.."] "..player.Name.." ("..distance..")")
    
    label.Parent = tag
    tag.Parent = head
end

local function UpdateAllPlayers()
    local counts = {Murderer = 0, Sheriff = 0, Juggernaut = 0, Armed = 0, Innocent = 0}
    
    for _, player in ipairs(Players:GetPlayers()) do
        local role = GetPlayerRole(player)
        counts[role] = counts[role] + 1
        
        if player.Character then
            UpdatePlayerDisplay(player)
        end
    end
    
    StatsLabel.Text = string.format(
        "üî¥ Murderers: %d\nüîµ Sheriffs: %d\nüü§ Juggernauts: %d\n‚öî Armed: %d\nüë§ Total: %d",
        counts.Murderer, counts.Sheriff, counts.Juggernaut, counts.Armed, #Players:GetPlayers()
    )
end

-- –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª
local lastUpdate = 0
Heartbeat:Connect(function()
    local now = os.clock()
    
    -- –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ UPDATE_DELAY —Å–µ–∫—É–Ω–¥
    if now - lastUpdate >= UPDATE_DELAY then
        UpdateAllPlayers()
        lastUpdate = now
    end
    
    -- –ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
    task.wait(FAST_UPDATE)
end)

-- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–≥—Ä–æ–∫–æ–≤
Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function(character)
        character:WaitForChild("Humanoid").Died:Connect(function()
            for _, child in ipairs(character:GetDescendants()) do
                if child.Name == "BD_Highlight" or child.Name == "BD_Tag" then
                    child:Destroy()
                end
            end
        end)
        task.wait(1)
        UpdatePlayerDisplay(player)
    end)
end)

-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
for _, player in ipairs(Players:GetPlayers()) do
    if player.Character then
        task.spawn(UpdatePlayerDisplay, player)
    end
end

print("[BD ESP] –ó–∞–ø—É—â–µ–Ω —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è "..UPDATE_DELAY.." —Å–µ–∫")
