--[[
  BloodDebt ESP Premium v3.0
  Features:
  - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π –∫–∞–∂–¥—ã–µ 0.5 —Å–µ–∫—É–Ω–¥—ã
  - UI —Å –∫–Ω–æ–ø–∫–æ–π –æ—Ç–∫–ª—é—á–µ–Ω–∏—è
  - –ü–ª–∞–≤–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏
  - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
]]

-- üî´ Weapon lists
local murdererWeapons = {
    ["JS-2 Derringy"] = true, ["JS-22"] = true, ["RR-LCP"] = true,
    ["Sawn-off"] = true, ["Rosen-Obrez"] = true, ["K1911"] = true,
    ["SKORPION"] = true, ["ZZ-90"] = true, ["Silver Steel K1911"] = true,
    ["Clothed Rosen-Obrez"] = true, ["Clothed Sawn-off"] = true,
    ["Kamatov"] = true, ["GILDED"] = true, ["JS-2 Bonds Derringy"] = true,
    ["Charcoal Steel JS-22"] = true, ["Pretty Pink RR-LCP"] = true
}

local sheriffWeapons = {
    ["RR-Snubby"] = true, ["GG-17"] = true, ["J9-M"] = true,
    ["I-412"] = true, ["Silver Steel RR-Snubby"] = true
}

local juggernautWeapons = {
    ["VK's ANKM"] = true,
    ["AT's KAR15"] = true,
    ["RY's GG-17"] = true
}

local innocentWeapons = {
    ["Lead Pipe"] = true, ["KitchenKnife"] = true, ["Boxcutters"] = true, ["Pen"] = true
}

-- üõ† –°–µ—Ä–≤–∏—Å—ã
local Services = {
    Players = game:GetService("Players"),
    StarterGui = game:GetService("StarterGui"),
    RunService = game:GetService("RunService"),
    TweenService = game:GetService("TweenService")
}

-- ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
local Settings = {
    UpdateInterval = 0.5,    -- –ß–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–æ–ª–µ–π
    FrameRate = 0.1,         -- –ß–∞—Å—Ç–æ—Ç–∞ –∫–∞–¥—Ä–æ–≤
    MaxDistance = 200        -- –î–∏—Å—Ç–∞–Ω—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
}

-- üé® –¶–≤–µ—Ç–∞
local Colors = {
    Murderer = Color3.fromRGB(255, 50, 50),
    Sheriff = Color3.fromRGB(50, 50, 255),
    Juggernaut = Color3.fromRGB(180, 0, 0),
    Innocent = Color3.fromRGB(50, 255, 50),
    Armed = Color3.fromRGB(175, 255, 255),
    UI = {
        Background = Color3.fromRGB(30, 30, 30),
        Text = Color3.fromRGB(255, 255, 255),
        Button = Color3.fromRGB(80, 80, 80)
    }
}

-- üîÑ –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
local State = {
    Active = true,
    Cache = {},
    Objects = {},
    Connections = {}
}

-- ‚ôªÔ∏è –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º
local function SafeCreate(className, properties)
    local obj = Instance.new(className)
    for prop, val in pairs(properties) do
        obj[prop] = val
    end
    table.insert(State.Objects, obj)
    return obj
end

-- üßπ –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
local function Cleanup()
    -- –£–¥–∞–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤
    for _, obj in ipairs(State.Objects) do
        pcall(obj.Destroy, obj)
    end
    State.Objects = {}

    -- –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
    for _, conn in pairs(State.Connections) do
        pcall(conn.Disconnect, conn)
    end
    State.Connections = {}

    -- –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
    State.Cache = {}
end

-- üîç –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–∏
local function DetermineRole(player)
    local items = {}
    
    -- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
    local backpack = player:FindFirstChild("Backpack")
    if backpack then
        for _, item in ipairs(backpack:GetChildren()) do
            table.insert(items, item.Name)
        end
    end

    -- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ä—É–∂–∏—è –≤ —Ä—É–∫–∞—Ö
    local character = player.Character
    if character then
        for _, item in ipairs(character:GetChildren()) do
            if item:IsA("Tool") then
                table.insert(items, item.Name)
            end
        end
    end

    -- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π
    for _, item in ipairs(items) do
        if WEAPONS.MURDERER[item] then return "Murderer" end
        if WEAPONS.SHERIFF[item] then return "Sheriff" end
        if WEAPONS.JUGGERNAUT[item] then return "Juggernaut" end
        if WEAPONS.INNOCENT[item] then return "Armed", item end
    end

    return "Innocent"
end

-- ‚ú® –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∏–≥—Ä–æ–∫–∞
local function HighlightPlayer(player, role)
    local character = player.Character
    if not character then return end

    -- –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –ø–æ–¥—Å–≤–µ—Ç–∫–∏
    for _, child in ipairs(character:GetDescendants()) do
        if child.Name == "RoleHighlight" then
            pcall(child.Destroy, child)
        end
    end

    local highlight = SafeCreate("Highlight", {
        Name = "RoleHighlight",
        FillTransparency = Settings.Highlight.FillTransparency,
        OutlineTransparency = Settings.Highlight.OutlineTransparency,
        FillColor = Colors[role] or Colors.Innocent,
        OutlineColor = Color3.new(0, 0, 0)
    })

    -- –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ
    local tween = Services.TweenService:Create(highlight, TweenInfo.new(0.3), {
        FillTransparency = Settings.Highlight.FillTransparency
    })
    tween:Play()

    highlight.Parent = character
end

-- üè∑ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–≥–∞
local function CreateNameTag(player, role, weapon)
    local character = player.Character
    if not character then return end

    local head = character:FindFirstChild("Head")
    if not head then return end

    -- –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ —Ç–µ–≥–∞
    for _, child in ipairs(head:GetDescendants()) do
        if child.Name == "RoleTag" then
            pcall(child.Destroy, child)
        end
    end

    -- –†–∞—Å—á—ë—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
    local distance = "??"
    local localPlayer = Services.Players.LocalPlayer
    if localPlayer.Character and localPlayer.Character:FindFirstChild("HumanoidRootPart") then
        distance = math.floor((character.HumanoidRootPart.Position - localPlayer.Character.HumanoidRootPart.Position).Magnitude) .. " studs"
    end

    -- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–≥–∞
    local billboard = SafeCreate("BillboardGui", {
        Name = "RoleTag",
        Size = UDim2.new(0, 200, 0, 50),
        StudsOffset = Vector3.new(0, 3, 0),
        AlwaysOnTop = true,
        MaxDistance = Settings.MaxDistance,
        Active = true,
        Adornee = head
    })

    local label = SafeCreate("TextLabel", {
        Name = "RoleLabel",
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        Font = Enum.Font.SourceSansBold,
        TextSize = 18,
        TextStrokeTransparency = 0.5,
        TextColor3 = Colors[role] or Colors.Innocent
    })

    -- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
    if role == "Armed" then
        label.Text = string.format("%s\n‚öî %s (%s)", player.Name, weapon, distance)
    elseif role == "Innocent" then
        label.Text = string.format("%s (%s)", player.Name, distance)
    else
        label.Text = string.format("%s: %s (%s)", role:upper(), player.Name, distance)
    end

    label.Parent = billboard
    billboard.Parent = head
end

-- üìä –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
local function CreateUI()
    local screenGui = SafeCreate("ScreenGui", {
        Name = "BloodDebtUI",
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    })

    local mainFrame = SafeCreate("Frame", {
        Size = UDim2.new(0, 250, 0, 200),
        Position = UDim2.new(1, -260, 0, 10),
        BackgroundColor3 = Colors.UI.Background,
        BackgroundTransparency = 0.3,
        BorderSizePixel = 0
    })

    local statsLabel = SafeCreate("TextLabel", {
        Size = UDim2.new(1, -10, 1, -50),
        Position = UDim2.new(0, 5, 0, 5),
        BackgroundTransparency = 1,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = Enum.TextYAlignment.Top,
        Font = Enum.Font.SourceSansBold,
        TextSize = 18,
        TextColor3 = Colors.UI.Text,
        Text = "–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö..."
    })

    -- –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è
    local toggleButton = SafeCreate("TextButton", {
        Size = UDim2.new(1, -10, 0, 30),
        Position = UDim2.new(0, 5, 1, -35),
        BackgroundColor3 = Colors.UI.Button,
        BackgroundTransparency = 0.5,
        TextColor3 = Colors.UI.Text,
        Font = Enum.Font.SourceSansBold,
        TextSize = 16,
        Text = "–û–¢–ö–õ–Æ–ß–ò–¢–¨ ESP"
    })

    -- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏
    toggleButton.MouseButton1Click:Connect(function()
        State.Active = not State.Active
        toggleButton.Text = State.Active and "–û–¢–ö–õ–Æ–ß–ò–¢–¨ ESP" or "–í–ö–õ–Æ–ß–ò–¢–¨ ESP"
        
        if not State.Active then
            Cleanup()
        else
            -- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–∏—Å—Ç–µ–º—É
            table.clear(State.Cache)
            InitializePlayers()
        end
    end)

    statsLabel.Parent = mainFrame
    toggleButton.Parent = mainFrame
    mainFrame.Parent = screenGui
    screenGui.Parent = Services.Players.LocalPlayer:WaitForChild("PlayerGui")

    return statsLabel
end

-- üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
local function UpdateStats(statsLabel)
    if not State.Active then return end

    local counts = {
        Murderer = 0,
        Sheriff = 0,
        Juggernaut = 0,
        Innocent = 0,
        Armed = 0
    }

    for _, player in ipairs(Services.Players:GetPlayers()) do
        local role = DetermineRole(player)
        counts[role] = counts[role] + 1
    end

    if statsLabel and statsLabel.Parent then
        statsLabel.Text = string.format(
            "üî¥ –£–±–∏–π—Ü—ã: %d\nüîµ –®–µ—Ä–∏—Ñ—ã: %d\nüü§ –î–∂–∞–≥–≥–µ—Ä–Ω–∞—É—Ç—ã: %d\n‚öî –í–æ–æ—Ä—É–∂–µ–Ω–Ω—ã–µ: %d\nüë§ –í—Å–µ–≥–æ: %d",
            counts.Murderer, counts.Sheriff, counts.Juggernaut,
            counts.Armed,
            #Services.Players:GetPlayers()
        )
    end
end

-- üë§ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä–æ–∫–∞
local function InitializePlayer(player)
    local function SetupCharacter(character)
        if not character then return end

        -- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–º–µ—Ä—Ç–∏
        local humanoid = character:WaitForChild("Humanoid")
        State.Connections["death_"..player.UserId] = humanoid.Died:Connect(function()
            for _, child in ipairs(character:GetDescendants()) do
                if child.Name == "RoleHighlight" or child.Name == "RoleTag" then
                    pcall(child.Destroy, child)
                end
            end
        end)

        -- –û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        task.delay(1, function()
            if not State.Active then return end
            if not character or not character.Parent then return end
            
            local role, weapon = DetermineRole(player)
            HighlightPlayer(player, role)
            CreateNameTag(player, role, weapon)
        end)
    end

    -- –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è
    State.Connections["char_"..player.UserId] = player.CharacterAdded:Connect(SetupCharacter)
    if player.Character then
        task.spawn(SetupCharacter, player.Character)
    end
end

-- üéÆ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
local function InitializePlayers()
    for _, player in ipairs(Services.Players:GetPlayers()) do
        InitializePlayer(player)
    end
end

-- üöÄ –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª
local function MainLoop()
    local statsLabel = CreateUI()
    InitializePlayers()

    -- –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
    State.Connections.playerAdded = Services.Players.PlayerAdded:Connect(InitializePlayer)

    -- –¶–∏–∫–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    while true do
        if State.Active then
            UpdateStats(statsLabel)
        end
        task.wait(Settings.UpdateInterval)
    end
end

-- ‚ö° –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã
State.Connections.main = Services.RunService.Heartbeat:Connect(MainLoop)

-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
Services.StarterGui:SetCore("SendNotification", {
    Title = "BloodDebt ESP v3.0",
    Text = "–°–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞\n–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É –≤ UI –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è",
    Duration = 5
})
