--[[
  BloodDebt ESP Stable v3.2
  Features:
  - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π –∫–∞–∂–¥—ã–µ 4 —Å–µ–∫—É–Ω–¥—ã
  - –ß–∏—Å—Ç—ã–π UI —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
  - –î–∏—Å—Ç–∞–Ω—Ü–∏—è –≤ studs
  - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
]]

-- üî´ –°–ø–∏—Å–∫–∏ –æ—Ä—É–∂–∏—è
local WEAPONS = {
    MURDERER = {
        ["JS-2 DERRINGY"] = true, ["JS-22"] = true, ["RR-LCP"] = true,
        ["Sawn-Off"] = true, ["Rosen-Obrez"] = true, ["K1911"] = true,
        ["SKORPION"] = true, ["ZZ-90"] = true, ["SILVER STEEL K1911"] = true,
        ["Clothed Rosen-Obrez"] = true, ["Clother Sawn-Off"] = true,
        ["Kamatov"] = true, ["GLIDED"] = true, ["JS-2 BONDS DERRINGY"] = true,
        ["Charcoal Steel JS-22"] = true, ["Pretty Pink RR-LCP"] = true
    },
    SHERIFF = {
        ["RR-Snubby"] = true, ["GG-17"] = true, ["J9-M"] = true,
        ["I-412"] = true, ["Silver Steel RR-Snubby"] = true
    },
    JUGGERNAUT = {
        ["ANKM"] = true, ["AT's KAR15"] = true
    },
    INNOCENT = {
        ["Lead Pipe"] = true, ["Kitchen Knife"] = true, ["Boxcutters"] = true
    }
}

-- üõ† –°–µ—Ä–≤–∏—Å—ã
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

-- ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
local SETTINGS = {
    UpdateInterval = 4,      -- –ß–∞—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–æ–ª–µ–π (4 —Å–µ–∫—É–Ω–¥—ã)
    MaxDistance = 200        -- –î–∏—Å—Ç–∞–Ω—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ (studs)
}

-- üé® –¶–≤–µ—Ç–∞
local COLORS = {
    Murderer = Color3.fromRGB(255, 50, 50),
    Sheriff = Color3.fromRGB(50, 50, 255),
    Juggernaut = Color3.fromRGB(180, 0, 0),
    Innocent = Color3.fromRGB(50, 255, 50),
    Armed = Color3.fromRGB(175, 255, 255),
    UI = {
        Background = Color3.fromRGB(30, 30, 30),
        Text = Color3.fromRGB(255, 255, 255)
    }
}

-- üîÑ –ö—ç—à –∏–≥—Ä–æ–∫–æ–≤
local PlayerCache = {}

-- ‚ôªÔ∏è –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
local function SafeCreate(instance, parent, properties)
    local obj = Instance.new(instance)
    for prop, val in pairs(properties) do
        obj[prop] = val
    end
    obj.Parent = parent
    return obj
end

-- üîç –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–∏
local function DetermineRole(player)
    local items = {}
    
    -- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
    local backpack = player:FindFirstChild("Backpack")
    if backpack then
        for _, item in ipairs(backpack:GetChildren()) do
            table.insert(items, item.Name)
        end
    end

    -- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ä—É–∂–∏—è –≤ —Ä—É–∫–∞—Ö
    local character = player.Character
    if character then
        for _, item in ipairs(character:GetChildren()) do
            if item:IsA("Tool") then
                table.insert(items, item.Name)
            end
        end
    end

    -- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π
    for _, item in ipairs(items) do
        if WEAPONS.MURDERER[item] then return "Murderer" end
        if WEAPONS.SHERIFF[item] then return "Sheriff" end
        if WEAPONS.JUGGERNAUT[item] then return "Juggernaut" end
        if WEAPONS.INNOCENT[item] then return "Armed", item end
    end

    return "Innocent"
end

-- ‚ú® –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∏–≥—Ä–æ–∫–∞
local function HighlightPlayer(player, role)
    local character = player.Character
    if not character then return end

    -- –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –ø–æ–¥—Å–≤–µ—Ç–∫–∏
    for _, child in ipairs(character:GetDescendants()) do
        if child.Name == "RoleHighlight" then
            child:Destroy()
        end
    end

    SafeCreate("Highlight", character, {
        Name = "RoleHighlight",
        FillTransparency = 0.7,
        OutlineTransparency = 0.3,
        FillColor = COLORS[role] or COLORS.Innocent,
        OutlineColor = Color3.new(0, 0, 0)
    })
end

-- üè∑ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–≥–∞
local function CreateNameTag(player, role, weapon)
    local character = player.Character
    if not character then return end

    local head = character:FindFirstChild("Head")
    if not head then return end

    -- –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ —Ç–µ–≥–∞
    for _, child in ipairs(head:GetDescendants()) do
        if child.Name == "RoleTag" then
            child:Destroy()
        end
    end

    -- –†–∞—Å—á—ë—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è
    local distance = "??"
    local localPlayer = Players.LocalPlayer
    if localPlayer.Character and localPlayer.Character:FindFirstChild("HumanoidRootPart") then
        distance = math.floor((character.HumanoidRootPart.Position - localPlayer.Character.HumanoidRootPart.Position).Magnitude) .. " studs"
    end

    -- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–≥–∞
    local billboard = SafeCreate("BillboardGui", head, {
        Name = "RoleTag",
        Size = UDim2.new(0, 200, 0, 50),
        StudsOffset = Vector3.new(0, 3, 0),
        AlwaysOnTop = true,
        MaxDistance = SETTINGS.MaxDistance
    })

    local label = SafeCreate("TextLabel", billboard, {
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        Font = Enum.Font.SourceSansBold,
        TextSize = 18,
        TextStrokeTransparency = 0.5,
        TextColor3 = COLORS[role] or COLORS.Innocent
    })

    -- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
    if role == "Armed" then
        label.Text = string.format("%s\n‚öî %s (%s)", player.Name, weapon, distance)
    elseif role == "Innocent" then
        label.Text = string.format("%s (%s)", player.Name, distance)
    else
        label.Text = string.format("%s: %s (%s)", role:upper(), player.Name, distance)
    end
end

-- üìä –°–æ–∑–¥–∞–Ω–∏–µ UI —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
local function CreateStatsUI()
    local screenGui = SafeCreate("ScreenGui", game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui"), {
        Name = "BloodDebtStats",
        ResetOnSpawn = false
    })

    local frame = SafeCreate("Frame", screenGui, {
        Size = UDim2.new(0, 250, 0, 150),
        Position = UDim2.new(1, -260, 0, 10),
        BackgroundColor3 = COLORS.UI.Background,
        BackgroundTransparency = 0.3
    })

    local statsLabel = SafeCreate("TextLabel", frame, {
        Size = UDim2.new(1, -10, 1, -10),
        Position = UDim2.new(0, 5, 0, 5),
        BackgroundTransparency = 1,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextYAlignment = Enum.TextYAlignment.Top,
        Font = Enum.Font.SourceSansBold,
        TextSize = 18,
        TextColor3 = COLORS.UI.Text,
        Text = "–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏..."
    })

    return statsLabel
end

-- üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
local function UpdateStats(statsLabel)
    local counts = {
        Murderer = 0,
        Sheriff = 0,
        Juggernaut = 0,
        Innocent = 0,
        Armed = 0
    }

    for _, player in ipairs(Players:GetPlayers()) do
        local role = DetermineRole(player)
        counts[role] = counts[role] + 1
    end

    if statsLabel and statsLabel.Parent then
        statsLabel.Text = string.format(
            "üî¥ –£–±–∏–π—Ü—ã: %d\nüîµ –®–µ—Ä–∏—Ñ—ã: %d\nüü§ –î–∂–∞–≥–≥–µ—Ä–Ω–∞—É—Ç—ã: %d\n‚öî –í–æ–æ—Ä—É–∂–µ–Ω–Ω—ã–µ: %d\nüë§ –í—Å–µ–≥–æ: %d",
            counts.Murderer, counts.Sheriff, counts.Juggernaut,
            counts.Armed,
            #Players:GetPlayers()
        )
    end
end

-- üë§ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–≥—Ä–æ–∫–∞
local function ProcessPlayer(player)
    local function SetupCharacter(character)
        if not character then return end

        -- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–º–µ—Ä—Ç–∏
        character:WaitForChild("Humanoid").Died:Connect(function()
            for _, child in ipairs(character:GetDescendants()) do
                if child.Name == "RoleHighlight" or child.Name == "RoleTag" then
                    pcall(child.Destroy, child)
                end
            end
        end)

        -- –û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        task.delay(1, function()
            if not character or not character.Parent then return end
            local role, weapon = DetermineRole(player)
            HighlightPlayer(player, role)
            CreateNameTag(player, role, weapon)
        end)
    end

    -- –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è
    player.CharacterAdded:Connect(SetupCharacter)
    if player.Character then
        task.spawn(SetupCharacter, player.Character)
    end
end

-- üöÄ –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª
local function MainLoop()
    local statsLabel = CreateStatsUI()

    -- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä–æ–∫–æ–≤
    for _, player in ipairs(Players:GetPlayers()) do
        ProcessPlayer(player)
    end

    -- –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
    Players.PlayerAdded:Connect(ProcessPlayer)

    -- –¶–∏–∫–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    while true do
        UpdateStats(statsLabel)
        task.wait(SETTINGS.UpdateInterval) -- 4 —Å–µ–∫—É–Ω–¥—ã
    end
end

-- ‚ö° –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã
RunService.Heartbeat:Connect(function()
    pcall(MainLoop)
end)

print("[BloodDebt ESP] –°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—â–µ–Ω–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ "..SETTINGS.UpdateInterval.." —Å–µ–∫)")
